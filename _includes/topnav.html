<nav class="navbar navbar-default navbar-fixed-top">
  <div class="container navbar-container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
        aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="{{ site.baseurl }}/" aria-label="Home">
        <span><img src="{{ '/assets/img/logonav.png' | relative_url }}" alt="{{ site.title }} Logo"
            class="navbar-logo"></span>
        <span class="site-title">{{ site.title }}</span>
      </a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li {% if page.sectionid=='docs' %}class="active"{% endif %}>
          <a href="{{ '/docs/home/' | relative_url }}">Docs</a>
        </li>
        <li {% if page.sectionid=='blog' %}class="active"{% endif %}>
          <a href="{{ site.posts.first.url | relative_url }}">Blog</a>
        </li>
      </ul>
      <div class="navbar-right">
        <!-- üîç Search Form -->
        <form class="navbar-form navbar-left" onsubmit="return false;" role="search">
          <div class="form-group has-feedback">
            <input id="search-box"
                   type="search"
                   class="form-control"
                   placeholder="Rechercher..."
                   aria-label="Search"
                   autocomplete="off"
                   minlength="2">
            <span class="form-control-feedback" aria-hidden="true">
              <i class="fa fa-search"></i>
            </span>
          </div>
        </form>
        <ul class="nav navbar-nav">
          <li>
            <a href="{{ site.git_address }}" aria-label="GitHub repository">
              <i class="fa fa-github" aria-hidden="true"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<!-- üîΩ Search Results Container -->
<div id="search-results" style="
  display: none;
  position: absolute;
  top: 60px;
  left: 0;
  right: 0;
  z-index: 9999;
  background: white;
  max-height: 70vh;
  overflow-y: auto;
  padding: 1em;
  border-top: 1px solid #ccc;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
"></div>

<!-- üåê Scripts for Search -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchBox = document.getElementById("search-box");
    const resultsContainer = document.getElementById("search-results");

    fetch("/search.json")
      .then(res => res.json())
      .then(data => {
        const docs = data.docs.filter(doc => doc.url.startsWith("/apprendreturc/docs/"));

        const idx = lunr(function () {
          this.ref("url");
          this.field("title");
          this.field("content");

          docs.forEach(function (doc) {
            this.add(doc);
          }, this);
        });

        searchBox.addEventListener("input", function () {
          const query = this.value.trim();
          resultsContainer.innerHTML = "";

          if (!query || query.length < 2) {
            resultsContainer.style.display = "none";
            return;
          }

          const results = idx.search(query);
          resultsContainer.style.display = results.length ? "block" : "none";

          if (results.length === 0) {
            resultsContainer.innerHTML = "<p>Aucun r√©sultat trouv√©.</p>";
            return;
          }

          results.forEach(result => {
            const doc = docs.find(d => d.url === result.ref);
            const div = document.createElement("div");
            div.style.marginBottom = "1em";
            div.innerHTML = `
              <a href="${doc.url}" style="font-weight:bold; font-size: 1.1em;">${doc.title}</a>
              <p style="margin:0.5em 0;">${doc.content.substring(0, 150)}...</p>`;
            resultsContainer.appendChild(div);
          });
        });

        // Hide results if clicked outside
        document.addEventListener("click", (e) => {
          if (!searchBox.contains(e.target) && !resultsContainer.contains(e.target)) {
            resultsContainer.style.display = "none";
          }
        });
      });
</script>

<style>
.navbar-logo {
  height: 20px;
  display: inline-block;
  vertical-align: middle;
  margin-right: 10px;
}
.site-title {
  vertical-align: middle;
}
.form-control-feedback {
  pointer-events: auto;
  cursor: pointer;
}
</style>
